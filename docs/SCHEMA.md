# Data Schema Documentation

## Minimum Base Schema (Hackathon Requirements)

This schema defines the standardized structure for all robot events processed by the system.

### Core Fields

| Field | Type | Source & Rules |
|-------|------|----------------|
| `record_id` | UUID/Int | Generated | Unique identifier per event |
| `timestamp` | ISO 8601 | Any file | Normalized to ISO 8601, inferred from sequence when missing |
| `joint` | string | Event logs | Standardized names (J1-J6, axis1-6 → J1-J6) |
| `collision_type` | enum | AI-derived | `hard_impact` / `soft_collision` / `emergency_stop` |
| `force_value` | float (N) | JSON logs | Validate units (0-10,000N acceptable range) |
| `severity` | enum | Calculated formula | `low` (< 300N), `med` (300-600N), `high`/`critical` (> 600N) |
| `recommended_action` | text | AI agent output | Technician-focused action steps (5-section format) |
| `confidence_flag` | enum | Calculated | `high` / `medium` / `inferred` |
| `recurrence_count` | int | Calculated | Number of similar events in 24hr window |
| `notes` | text | Generated | Data quality notes and assumptions |

### Field Details

#### record_id
- **Format**: UUID v4 string
- **Example**: `"550e8400-e29b-41d4-a716-446655440000"`
- **Rules**: Generated automatically, guaranteed unique

#### timestamp
- **Format**: ISO 8601 (`YYYY-MM-DDTHH:MM:SS`)
- **Example**: `"2025-11-17T09:00:15"`
- **Rules**: 
  - Normalized from various formats (HH:MM:SS, YYYY-MM-DD HH:MM:SS, etc.)
  - If missing, inferred from sequence with `confidence_flag = 'inferred'`
  - Always stored in UTC

#### joint
- **Format**: String `"J1"` through `"J6"` or `"UNKNOWN"`
- **Example**: `"J3"`
- **Rules**:
  - Standardized from: `axis1` → `J1`, `axis2` → `J2`, etc.
  - Extracted from error codes, descriptions, or data fields
  - `"UNKNOWN"` if cannot be determined

#### collision_type
- **Format**: Enum: `"hard_impact"`, `"soft_collision"`, `"emergency_stop"`, or `null`
- **Example**: `"hard_impact"`
- **Rules**:
  - Detected from keywords: collision, crash, impact → `hard_impact`
  - contact, touch, brush → `soft_collision`
  - e-stop, emergency → `emergency_stop`
  - Can be `null` if not a collision event

#### force_value
- **Format**: Float in Newtons (N)
- **Example**: `645.0`
- **Rules**:
  - Valid range: 0-10,000N
  - Extracted from JSON logs, sensor data, or descriptions
  - Can be `null` if not available
  - Outliers flagged in `notes`

#### severity
- **Format**: Enum: `"low"`, `"med"`, `"high"`, `"critical"`
- **Example**: `"critical"`
- **Rules**:
  - Calculated from force value:
    - `low`: < 300N
    - `med`: 300-600N
    - `high`: 600-800N
    - `critical`: > 800N
  - Falls back to raw severity if force not available
  - Influenced by error codes and recurrence

#### recommended_action
- **Format**: Text (5-section structured format)
- **Example**: See AI Agent Output Format below
- **Rules**:
  - Generated by AI agent
  - Must include all 5 sections:
    1. Diagnose cause
    2. Step-by-step inspection procedure
    3. Required maintenance actions
    4. Safety clearance procedure
    5. Return-to-service conditions

#### confidence_flag
- **Format**: Enum: `"high"`, `"medium"`, `"inferred"`
- **Example**: `"high"`
- **Rules**:
  - `high`: Has timestamp, joint, and force value
  - `medium`: Has 2 of 3 key fields
  - `inferred`: Missing critical data, assumptions made

#### recurrence_count
- **Format**: Integer
- **Example**: `3`
- **Rules**:
  - Calculated during deduplication
  - Groups events by joint + date (24hr window)
  - `1` = single occurrence, `>1` = recurring issue

## Data Cleaning Decisions

### Missing Timestamps
- **Approach**: Infer from sequence if events are ordered
- **Confidence**: Marked with `confidence_flag = 'inferred'`
- **Documentation**: Noted in `notes` field

### Impute vs. Discard
- **Keep**: Records with partial data if key fields exist (timestamp, joint, force)
- **Discard**: Only if missing critical identifiers (no joint, no timestamp, no description)
- **Tracking**: Discard count logged, validation metrics track completeness

### Standardize Naming
- **Error Codes**: Mapped to canonical names via lookup table
  - `SRVO-160`, `SRVO-161`, `SRVO-005` → `"Torque limit reached"`
  - `SRVO-324` → `"Collision detected"`
  - `TEMP-100` → `"Temperature anomaly"`
- **Joints**: All variants mapped to `J1-J6` format

### Label Uncertainty
- **confidence_flag**: Used for data quality tracking
- **notes**: Free-text field for edge cases and assumptions
- **Validation**: Schema validation ensures required fields present

### Deduplicate + Track Frequency
- **Method**: Group by joint + date (24hr window)
- **Output**: `recurrence_count` field added
- **Purpose**: Identifies chronic issues vs. isolated incidents

## Validation Rules

### Required Fields
- `record_id`: Must be present and unique
- `timestamp`: Must be valid ISO 8601 format
- `joint`: Must be present (can be "UNKNOWN")
- `severity`: Must be one of: `low`, `med`, `high`, `critical`

### Optional Fields
- `collision_type`: Can be `null`
- `force_value`: Can be `null` (severity calculated from other indicators)
- `recommended_action`: Populated by AI agent

### Validation Target
- **Accuracy Goal**: 75%+ overall score
- **Field Accuracy**: Weighted average across all fields
- **Meets Target**: `overall_score >= 75.0`

## Example Event

```json
{
  "record_id": "550e8400-e29b-41d4-a716-446655440000",
  "timestamp": "2025-11-17T09:00:15",
  "joint": "J3",
  "collision_type": "hard_impact",
  "force_value": 645.0,
  "severity": "high",
  "recommended_action": "See maintenance_report",
  "confidence_flag": "high",
  "recurrence_count": 3,
  "notes": "",
  "original_event": {
    "event_id": "error_0_1234567890",
    "event_type": "error_log",
    "error_code": "SRVO-160",
    "description": "SRVO-160 - Collision detected"
  },
  "maintenance_report": {
    "diagnose_cause": "High force impact on J3 joint indicates potential mechanical failure...",
    "inspection_procedure": "1. Check J3 joint for physical damage...",
    "maintenance_actions": "Replace J3 joint assembly...",
    "safety_clearance": "Verify all safety interlocks...",
    "return_to_service": "All tests pass, force values within normal range..."
  }
}
```

